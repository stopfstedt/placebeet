RewriteEngine On

RewriteCond %{REQUEST_URI} !^index.php$
RewriteCond %{REQUEST_URI} ^/(\d+)$
RewriteRule (.*) /index.php?width=%1 [QSA,L]

RewriteCond %{REQUEST_URI} !^index.php$
RewriteCond %{REQUEST_URI} ^/(\d+)(x|/)(\d+)$
RewriteRule (.*) /index.php?width=%1&height=%3 [QSA,L]

RewriteCond %{REQUEST_URI} !^index.php$
RewriteCond %{REQUEST_URI} ^/(\d+)/g$
RewriteRule (.*) /index.php?width=%1&greyscale=y [QSA,L]

RewriteCond %{REQUEST_URI} !^index.php$
RewriteCond %{REQUEST_URI} ^/(\d+)(x|/)(\d+)/g$
RewriteRule (.*) /index.php?width=%1&height=%3&greyscale=y [QSA,L]

RewriteCond %{REQUEST_URI} !^index.php$
RewriteCond %{REQUEST_URI} ^/d/(\d+)$
RewriteRule (.*) /index.php?width=%1&watermark=y [QSA,L]

RewriteCond %{REQUEST_URI} !^index.php$
RewriteCond %{REQUEST_URI} ^/d/(\d+)(x|/)(\d+)$
RewriteRule (.*) /index.php?width=%1&height=%3&watermark=y [QSA,L]

RewriteCond %{REQUEST_URI} !^index.php$
RewriteCond %{REQUEST_URI} ^/d/(\d+)/g$
RewriteRule (.*) /index.php?width=%1&watermark=y&greyscale=y [QSA,L]

RewriteCond %{REQUEST_URI} !^index.php$
RewriteCond %{REQUEST_URI} ^/d/(\d+)(x|/)(\d+)/g$
RewriteRule (.*) /index.php?width=%1&height=%3&watermark=y&greyscale=y [QSA,L]
